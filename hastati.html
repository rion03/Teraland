<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />

  <title>í•˜ìŠ¤íƒ€í‹° ë©”ì¸</title>
  <style>
    body { margin: 0; font-family: Pretendard, sans-serif; background: #f5f6fa; }
    header {
      display: flex; justify-content: space-between; align-items: center;
      background: #2f80ed; padding: 16px 32px; color: white;
    }
    nav ul { list-style: none; display: flex; gap: 24px; padding: 0; margin: 0; }
    nav li { cursor: pointer; font-weight: bold; }
    #auth-modal {
      display: none; position: fixed; top: 80px; right: 40px;
      background: white; border: 1px solid #ccc; padding: 20px;
      border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 999; width: 300px;
    }
    input, select, button {
      width: 100%; padding: 10px; margin: 6px 0;
      border-radius: 6px; border: 1px solid #ccc;
    }
    button {
      background: #2f80ed; color: white;
      font-weight: bold; border: none; cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <h2>í•˜ìŠ¤íƒ€í‹°</h2>
    <div id="auth-actions">
      <a href="#" onclick="toggleLogin()" style="margin-right: 12px; color: white;">ë¡œê·¸ì¸</a>
      <a href="#" onclick="toggleRegister()" style="margin-right: 12px; color: white;">íšŒì›ê°€ì…</a>
      <a href="#" onclick="enterAdminMode()" style="color: white;">ê´€ë¦¬ì</a>
    </div>
  </header>

  <nav style="background: white; padding: 16px 32px;">
    <ul>
      <li onclick="requireLogin('hastati-member.html')">ì¼ì •í‘œ ì‹ ì²­</li>
      <li onclick="requireLogin('hastati-confirm.html')">í™•ì • ìŠ¤ì¼€ì¤„í‘œ</li>
      <li onclick="requireLogin('hastati-admin.html')">ê´€ë¦¬ì í˜ì´ì§€</li>
    </ul>
  </nav>

  <!-- ë¡œê·¸ì¸ / íšŒì›ê°€ì… ëª¨ë‹¬ -->
  <div id="auth-modal">
    <div id="login-form">
      <h3>ë¡œê·¸ì¸</h3>
      <input id="login-id" placeholder="ì•„ì´ë””">
      <input id="login-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
      <button onclick="handleLogin()">ë¡œê·¸ì¸</button>
    </div>
    <div id="register-form" style="display:none">
      <h3>íšŒì›ê°€ì…</h3>
      <input id="reg-id" placeholder="ì•„ì´ë”” (ì˜ë¬¸+ìˆ«ì 6ì ì´ìƒ)">
      <input id="reg-pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì)">
      <button type="button" onclick="handleRegister()">íšŒì›ê°€ì…</button>

      <input id="reg-nick" placeholder="ë””ìŠ¤ì½”ë“œ ë‹‰ë„¤ì„">
      <select id="reg-role">
        <option>í•˜ìŠ¤íƒ€í‹°</option>
        <option>ë ˆê°€íˆ¬ìŠ¤</option>
        <option>í—¤ë‚˜</option>
      </select>
      <button onclick="handleRegister()">íšŒì›ê°€ì…</button>
    </div>
  </div>

  <script>
    let isAdmin = false;

    const currentUserId = sessionStorage.getItem("currentUser");
    const user = currentUserId ? JSON.parse(localStorage.getItem("user_" + currentUserId)) : null;
    const authBox = document.getElementById('auth-actions');

    if (user) {
      authBox.innerHTML = `
        <span style="color:white;">ğŸŒ¿ ${user.nickname} (${user.role})ë‹˜</span>
        <button onclick="logout()" style="margin-left: 12px; background: white; color: #2f80ed; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer;">
          ë¡œê·¸ì•„ì›ƒ
        </button>
      `;
    }

    function toggleLogin() {
      document.getElementById('auth-modal').style.display = 'block';
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
    }

    function toggleRegister() {
      document.getElementById('auth-modal').style.display = 'block';
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
    }

    function handleLogin() {
      const id = document.getElementById('login-id').value.trim();
      const pw = document.getElementById('login-pw').value.trim();
      const user = JSON.parse(localStorage.getItem("user_" + id) || "null");
      if (!user) return alert("íšŒì›ê°€ì…ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.");
      if (user.pw !== pw) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      if (user.status !== "approved") return alert("ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.");
      sessionStorage.setItem("currentUser", id);
      alert(user.nickname + "ë‹˜ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
      location.href = "hastati.html";
    }

    function handleRegister() {
      const id = document.getElementById('reg-id').value.trim();
      const pw = document.getElementById('reg-pw').value.trim();
      const nick = document.getElementById('reg-nick').value.trim();
      const role = document.getElementById('reg-role').value;

      const idValid = /^[a-zA-Z0-9]{6,}$/.test(id);
      const pwValid = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[\W_]).{6,}$/.test(pw);

      if (!idValid) return alert("ì•„ì´ë””ëŠ” ì˜ë¬¸+ìˆ«ì 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
      if (!pwValid) return alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì–´ + ìˆ«ì + íŠ¹ìˆ˜ê¸°í˜¸ í¬í•¨ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
      if (!nick) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      if (!['í•˜ìŠ¤íƒ€í‹°','ë ˆê°€íˆ¬ìŠ¤','í—¤ë‚˜'].includes(role)) return alert("ì†Œì†ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      if (localStorage.getItem("user_" + id)) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");

      localStorage.setItem("user_" + id, JSON.stringify({
        id, pw, nickname: nick, role, status: "pending"
      }));
      alert("íšŒì›ê°€ì… ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      document.getElementById('auth-modal').style.display = 'none';
    }

    function enterAdminMode() {
      const code = prompt("ê´€ë¦¬ì ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”");
      if (code === "0109") {
        alert("ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
        sessionStorage.setItem("isAdmin", "true");
        isAdmin = true;
      } else {
        alert("ê´€ë¦¬ì ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    }

    function logout() {
      sessionStorage.removeItem("currentUser");
      sessionStorage.removeItem("isAdmin");
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      location.href = "hastati.html";
    }

    function requireLogin(target) {
      const userId = sessionStorage.getItem("currentUser");
      const user = userId ? JSON.parse(localStorage.getItem("user_" + userId)) : null;
      const isAdminSession = sessionStorage.getItem("isAdmin") === "true";

      if (!user && !isAdminSession) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
      }

      if (target === "hastati-admin.html" && !isAdminSession) {
        alert("ê´€ë¦¬ì ëª¨ë“œë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        return;
      }

      location.href = target;
    }
  </script>
</body>
</html>
